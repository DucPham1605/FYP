{"version":3,"file":"static/webpack/static\\development\\pages\\admin\\journal.js.d870d089ba1d37c400c2.hot-update.js","sources":["webpack:///./components/Journal/CreateJournal.js"],"sourcesContent":["import Link from 'next/link';\r\nimport { useState, useEffect } from 'react';\r\nimport Router from 'next/router';\r\nimport { withRouter } from 'next/router'; //use router,export component with router\r\n\r\nimport { getCookie, isLoggedIn } from '../../actions/handleCookie';\r\nimport { listCategory } from '../../actions/category';\r\nimport { listTag } from '../../actions/tag';\r\nimport { createJournal } from '../../actions/journal';\r\n\r\nimport dynamic from 'next/dynamic';\r\n\r\n//Quill does not suppport SSR, so it's only loaded and rendered in the browser.\r\nconst ReactQuill = dynamic(() => import('react-quill'), { ssr: false });\r\n\r\nconst CreateJournal = ({ router }) => {\r\n\r\n  //grabbing journal from local storage and set as default\r\n    const grabJournalInLS = () => {\r\n    \tif(typeof window === 'undefined'){\r\n    \t\treturn false;\r\n    \t}\r\n\r\n    \tif(localStorage.getItem('journal')){\r\n    \t\treturn JSON.parse(localStorage.getItem('journal'))\r\n    \t} else {\r\n    \t\treturn false\r\n    \t}\r\n    }\r\n\r\n    //creating state using react Hook\r\n    const [categories, setCategories] = useState([]);\r\n    const [tags, setTags] = useState([]);\r\n\r\n    const [checkedCategory, setCheckedCategory] = useState([]); // categories\r\n    const [checkedTag, setCheckedTag] = useState([]); // tags\r\n\r\n\tconst [content, setContent] = useState(grabJournalInLS());\r\n    const [values, setValues] = useState({\r\n        error: '',\r\n        sizeError: '',\r\n        status: '',\r\n        formData: '',\r\n        title: '',\r\n        hidePublishButton: false\r\n    });\r\n\r\n     const { error, sizeError, status, formData, title, hidePublishButton } = values;\r\n     const token = getCookie('token');\r\n\r\n      useEffect(() => {\r\n        //Browser API to create form data\r\n        setValues({ ...values, formData: new FormData() });\r\n        initCategories();\r\n        initTags();\r\n    }, [router]); //when router change,setValue is called\r\n\r\n       const initCategories = () => {\r\n        listCategory().then(data => {\r\n            if (data.error) {\r\n                setValues({ ...values, error: data.error });\r\n            } else {\r\n                setCategories(data);\r\n            }\r\n        });\r\n    };\r\n\r\n       const initTags = () => {\r\n        listTag().then(data => {\r\n            if (data.error) {\r\n                setValues({ ...values, error: data.error });\r\n            } else {\r\n                setTags(data);\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n   const publishJournal = event => {\r\n        event.preventDefault();\r\n        createJournal(formData, token).then(data => {\r\n            if (data.error) {\r\n                setValues({ ...values, error: data.error });\r\n            } else {\r\n                setValues({ ...values, title: '', error: '', status: `A new journal titled \"${data.title}\" is created` });\r\n                setContent('');\r\n                setCategories([]);\r\n                setTags([]);\r\n            }\r\n        });\r\n    };\r\n\r\n     const handleChange = name => event => {\r\n        const value = name === 'photo' ? event.target.files[0] : event.target.value;\r\n        formData.set(name, value);\r\n        setValues({ ...values, [name]: value, formData, error: '' });\r\n    };\r\n\r\n     const handleBodyContent = event => {\r\n        setContent(event);\r\n        //bug fixed,set wrong name for form data key\r\n        formData.set('content', event);\t//populated form data\r\n        console.log(event);\r\n        //save content to local storage\r\n        if (typeof window !== 'undefined') {\r\n            localStorage.setItem('journal', JSON.stringify(event));\r\n        }   \r\n    };\r\n\r\n    \t//fix re-render issues\r\n    const handleCheckCategory = category => () => {\r\n        setValues({ ...values, error: '' });\r\n        // return the first index or -1\r\n        const clickedCategory = checkedCategory.indexOf(category);\r\n        const all = [...checkedCategory];\r\n\r\n        if (clickedCategory === -1) {\r\n            all.push(category);\r\n        } else {\r\n            all.splice(clickedCategory, 1);\r\n        }\r\n        console.log(all);\r\n        setCheckedCategory(all); //update state\r\n        formData.set('categories', all);\r\n    };\r\n\r\n\r\n     const handleCheckTag = tag => () => {\r\n        setValues({ ...values, error: '' });\r\n        // return the first index or -1\r\n        const clickedTag = checkedTag.indexOf(tag);  //finding index of that tag\r\n        console.log(clickedTag);\r\n        const all = [...checkedTag];\r\n\r\n        if (clickedTag === -1) { //if that tag is not in checkedTag array\r\n            all.push(tag);  //push tag\r\n        } else {\r\n            all.splice(clickedTag, 1);\r\n        }\r\n        console.log(all);\r\n        setCheckedTag(all); //update state\r\n        formData.set('tags', all);\r\n    };\r\n\r\n\r\n    const showCategories = () => {\r\n        return (\r\n            //categories && categories.map\r\n            categories.map((category, index) => (\r\n                <li key={index} className=\"list-unstyled\">\r\n                    <input onChange={handleCheckCategory(category._id)} type=\"checkbox\" className=\"mr-2\" />\r\n                    <label className=\"form-check-label\">{category.name}</label>\r\n                </li>\r\n            ))\r\n        );\r\n    }\r\n\r\n\r\n        const showTags = () => {\r\n            //tags && tags.map\r\n        return (\r\n            tags.map((tag,index) => (\r\n                <li key={index} className=\"list-unstyled\">\r\n                    <input onChange={handleCheckTag(tag._id)} type=\"checkbox\" className=\"mr-2\" />\r\n                    <label className=\"form-check-label\">#{tag.name}</label>\r\n                </li>\r\n            ))\r\n        );\r\n    }\r\n\r\n    const showStatus = () => {\r\n        if(error) {\r\n            return <div className=\"alert alert-danger\">{error}</div>\r\n        }\r\n        else if(status) {\r\n            return <div className=\"alert alert-success\">{status}</div>\r\n        }\r\n    }\r\n\r\n   /* const showStatus = () => {\r\n        return <div className=\"alert alert-success\" style={{display: status ? '' : 'none'}}>{status}</div>\r\n    }*/\r\n\r\n\r\n    const handleError = name => () => {\r\n        setValues({...values,error: ''})\r\n    }\r\n\r\n    //Quill JS handle parsing image to binary string\r\n const createJournalForm = () => {\r\n        return (\r\n            <form onSubmit={publishJournal} onClick={handleError()}>\r\n                <div className=\"form-group\">\r\n                    <label>Title</label>\r\n                    <input type=\"text\" className=\"form-control\" value={title} placeholder=\"Write your title here\" onChange={handleChange('title')}/>\r\n                </div>\r\n\r\n                <div className=\"form-group\">\r\n                    <ReactQuill modules={CreateJournal.modules} formats={CreateJournal.formats} value={content} placeholder=\"Write something...\" onChange={handleBodyContent} />\r\n                </div>\r\n\r\n                <div>\r\n                    <button type=\"submit\" className=\"btn btn-primary\">\r\n                        Publish\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        );\r\n    };\r\n\r\n    //rendering the page here\r\n    return <div className=\"container-fluid\">\r\n    \t<div className=\"row\">\r\n            <div className=\"col-md-12\">\r\n            {showStatus()}\r\n            </div>\r\n\r\n    \t\t<div className=\"col-md-12\">\r\n    \t\t{createJournalForm()}\r\n    \t\t</div>\r\n\r\n    \t\t<div className=\"col-md-4\">\r\n\r\n    <div className=\"form-group pb-2\">\r\n\t   <h5>Featured Image</h5>\r\n\t   <hr/>\r\n\r\n\t   <small className=\"text-muted\">Maximum Size: 1MB</small>\r\n\t   <label className=\"btn btn-outline-info\">Upload Featured image\r\n\t       <input onChange={handleChange('photo')} type=\"file\" accept=\"images/*\" hidden/> \r\n\t   </label>\r\n    </div>\r\n\r\n    \t\t<h4>Categories</h4>\r\n    \t\t<hr/>\r\n    \t\t<ul style={{maxHeight: '100px',overflowY: 'scroll'}}>{showCategories()}</ul>\r\n    \t\t<h4>Tags</h4>\r\n    \t\t<hr/>\r\n    \t\t<ul style={{maxHeight: '100px',overflowY: 'scroll'}}>{showTags()}</ul>\r\n    \t\t</div>\r\n    \t</div>\r\n    </div>;\r\n};\r\n\r\nCreateJournal.modules = {\r\n    toolbar: [\r\n        [{ header: [1,2,3,4,5,6] }, { font: [] }],\r\n        [{ size: [] }],\r\n        ['bold', 'italic', 'underline', 'strike'],\r\n        [{ list: 'ordered' }, { list: 'bullet' }],\r\n        ['link', 'image', 'video'],\r\n        ['clean'],\r\n        ['code-block']\r\n    ]\r\n};\r\n \r\nCreateJournal.formats = [\r\n    'header',\r\n    'font',\r\n    'size',\r\n    'bold',\r\n    'italic',\r\n    'underline',\r\n    'strike',    \r\n    'list',\r\n    'bullet',\r\n    'link',\r\n    'image',\r\n    'video',\r\n    'code-block'\r\n];\r\n\r\nexport default withRouter(CreateJournal);"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA,iBAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AADA;AAwBA;AACA;AACA;AACA;AACA;AACA;AANA;AAvBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiCA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAJA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAdA;AACA;AAgBA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAfA;AACA;AAiBA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAFA;AASA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAOA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;;;;;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AAFA;AACA;AACA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AALA;AAYA;AAgBA;;;;A","sourceRoot":""}