{"version":3,"file":"static/webpack/static\\development\\pages\\admin\\[slug].js.221f3b278c9e9342e4ee.hot-update.js","sources":["webpack:///./components/Journal/AmendJournal.js"],"sourcesContent":["import Link from 'next/link';\r\nimport { useState, useEffect } from 'react';\r\nimport Router from 'next/router';\r\nimport { withRouter } from 'next/router'; //use router,export component with router\r\nimport { getCookie, isLoggedIn } from '../../actions/handleCookie';\r\nimport { listCategory } from '../../actions/category';\r\nimport { listTag } from '../../actions/tag';\r\nimport { createJournal,readJournal,updateJournal } from '../../actions/journal';\r\nimport dynamic from 'next/dynamic';\r\nimport { API } from '../../config';\r\n\r\n//this modules will be imported dynamically\r\nconst ReactQuill = dynamic(() => import('react-quill'), { ssr: false }); //making sure that react quill only runs in frontend\r\n\r\nconst AmendJournal = ({router}) => {\r\n\r\n    const [categories, setCategories] = useState([]);\r\n    const [tags, setTags] = useState([]);\r\n\r\n    const [checkedCategory, setCheckedCategory] = useState([]); \r\n    const [checkedTag, setCheckedTag] = useState([]); \r\n\r\n    const [content,setContent] = useState('')\r\n    const [values,setValues] = useState({\r\n        error: '',\r\n        success:'',\r\n        formData: '',\r\n        title: ''\r\n    })\r\n\r\n    const {error,success,formData,title} = values\r\n    const token = getCookie('token'); \r\n\r\n    useEffect(()=>{\r\n        setValues({...values,formData: new FormData()})\r\n        loadJournal()\r\n        loadCategories()\r\n        loadTags()\r\n    },[router])\r\n\r\n\r\n    const loadJournal = () => {\r\n        const slug = router.query.slug\r\n        if(slug){\r\n            readJournal(slug).then(data=>{\r\n                if(data.error){\r\n                    console.log(data.error)\r\n                } else {\r\n                    setValues({...values,title: data.title})\r\n                    setContent(data.content)\r\n                    loadCheckedCategories(data.categories)\r\n                    loadCheckedTags(data.tags)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n      const loadCategories = () => {\r\n        listCategory().then(data => {\r\n            if (data.error) {\r\n                setValues({ ...values, error: data.error });\r\n            } else {\r\n                setCategories(data);\r\n            }\r\n        });\r\n    };\r\n\r\n    const loadTags = () => {\r\n        listTag().then(data => {\r\n            if (data.error) {\r\n                setValues({ ...values, error: data.error });\r\n            } else {\r\n                setTags(data);\r\n            }\r\n        });\r\n    };\r\n\r\n        const loadCheckedCategories = categories => {\r\n        let oldCategories = []\r\n        categories.map((category)=>{\r\n            oldCategories.push(category._id)\r\n        })\r\n        console.log(oldCategories)\r\n        setCheckedCategory(oldCategories)\r\n\r\n    }\r\n\r\n      const loadCheckedTags = tags => {\r\n        let oldTags = []\r\n        tags.map((tag)=>{\r\n            oldTags.push(tag._id)\r\n        })\r\n        console.log(oldTags)\r\n        setCheckedTag(oldTags)\r\n\r\n    }\r\n\r\n    const checkOldCategories = category => {\r\n         const oldCategory = checkedCategory.indexOf(category)\r\n         if(oldCategory === -1){\r\n            return false\r\n         } else {\r\n            return true\r\n         }\r\n    }\r\n\r\n      const checkOldTags = tag => {\r\n         const oldTag = checkedTag.indexOf(tag)\r\n         if(oldTag === -1){\r\n            return false\r\n         } else {\r\n            return true\r\n         }\r\n    }\r\n\r\n    const handleContent = event => {\r\n        setContent(event)\r\n        formData.set('content', event)\r\n    }\r\n\r\n    const setData = () => {\r\n        formData.set(\"title\",title)\r\n        formData.set(\"content\",content)\r\n        formData.set(\"categories\",checkedCategory)\r\n        formData.set(\"tags\",checkedTag)\r\n    }\r\n\r\n    const editJournal = event => {\r\n        event.preventDefault()\r\n        setData()\r\n        updateJournal(formData,token,router.query.slug).then(data=>{\r\n            if(data.error) {\r\n                setValues({...values,error: data.error})\r\n            } else {\r\n                setValues({...values,title: '',success: `Journal titled ${data.title} is updated`})\r\n                if(isLoggedIn() && isLoggedIn().role === 'admin'){\r\n                    Router.replace(`/admin/${router.query.slug}`)\r\n                } else if (isLoggedIn() && isLoggedIn().role === 'member'){\r\n                    Router.replace(`/member`)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n  const handleChange = name => event => {\r\n        const value = name === 'photo' ? event.target.files[0] : event.target.value;\r\n        formData.set(name, value);\r\n        setValues({ ...values, [name]: value, formData, error: '' });\r\n    };\r\n\r\n    const handleCheckCategory = category => () => {\r\n        setValues({ ...values, error: '' });\r\n        // return the first index or -1\r\n        const clickedCategory = checkedCategory.indexOf(category);\r\n        const all = [...checkedCategory];\r\n\r\n        if (clickedCategory === -1) {\r\n            all.push(category);\r\n        } else {\r\n            all.splice(clickedCategory, 1);\r\n        }\r\n        console.log(all);\r\n        setCheckedCategory(all); //update state\r\n        formData.set('categories', all);\r\n    };\r\n\r\n\r\n     const handleCheckTag = tag => () => {\r\n        setValues({ ...values, error: '' });\r\n        // return the first index or -1\r\n        const clickedTag = checkedTag.indexOf(tag);  //finding index of that tag\r\n        console.log(clickedTag);\r\n        const all = [...checkedTag];\r\n\r\n        if (clickedTag === -1) { //if that tag is not in checkedTag array\r\n            all.push(tag);  //push tag\r\n        } else {\r\n            all.splice(clickedTag, 1);\r\n        }\r\n        console.log(all);\r\n        setCheckedTag(all); //update state\r\n        formData.set('tags', all);\r\n    };\r\n\r\n     const showCategories = () => {\r\n        return (\r\n            categories.map((category, index) => (\r\n                <li key={index} className=\"list-unstyled\">\r\n                    <input onChange={handleCheckCategory(category._id)} checked={checkOldCategories(category._id)}  type=\"checkbox\" className=\"mr-2\" />\r\n                    <label className=\"form-check-label\">{category.name}</label>\r\n                </li>\r\n            ))\r\n        );\r\n    }\r\n    \r\n    const showTags = () => {\r\n        return (\r\n            tags.map((tag,index) => (\r\n                <li key={index} className=\"list-unstyled\">\r\n                    <input onChange={handleCheckTag(tag._id)} checked={checkOldTags(tag._id)} type=\"checkbox\" className=\"mr-2\" />\r\n                    <label className=\"form-check-label\">#{tag.name}</label>\r\n                </li>\r\n            ))\r\n        );\r\n    }\r\n\r\n    const showStatus = () => {\r\n        if(success){\r\n            return <div className=\"alert alert-success\">{success}</div>\r\n        } else if(error){\r\n            return <div className=\"alert alert-danger\">{error}</div>\r\n        }\r\n    }\r\n\r\n    const updateJournalForm = () => {\r\n        return (\r\n            <form onSubmit={editJournal}>\r\n                <div className=\"form-group\">\r\n                    <label>Title</label>\r\n                    <input type=\"text\" className=\"form-control\" \r\n                    value={title} \r\n                    placeholder=\"Write your title here\"\r\n                    onChange={handleChange('title')} />\r\n                </div>\r\n\r\n                <div className=\"form-group\">\r\n                    <ReactQuill \r\n                    modules={AmendJournal.modules} \r\n                    formats={AmendJournal.formats} \r\n                    value={content} \r\n                    placeholder=\"Write something...\"\r\n                    onChange = {handleContent} />\r\n                </div>\r\n\r\n                <div>\r\n                    <button type=\"submit\" className=\"btn btn-primary mb-2\">\r\n                        Update\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        );\r\n    };\r\n\r\n\r\n    return ( \r\n        <div className=\"container-fluid\">\r\n            <div className=\"row\">\r\n                <div className=\"col-md-8\">\r\n                    {showStatus()}\r\n                </div>\r\n\r\n                <div className=\"col-md-8 mt-2 mb-2\">\r\n                {content && (\r\n                    <img style={{ width: '100%' }} src={`${API}/journal/photo/${router.query.slug}`} alt={title} />\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"col-md-8\">\r\n                    {updateJournalForm()}\r\n                </div>\r\n\r\n                 <div className=\"col-md-4\">\r\n                        <div className=\"form-group pb-2\">\r\n                            <h5>Featured Image</h5>\r\n                            <hr/>\r\n                            <small className=\"text-muted\">Maximum Size: 1MB</small>\r\n                            <label className=\"btn btn-outline-info\">Change Featured Image\r\n                                <input onChange={handleChange('photo')} type=\"file\" accept=\"images/*\" hidden/> \r\n                            </label>\r\n                        </div>\r\n                        <h4>Categories</h4>\r\n                        <hr/>\r\n                        <ul style={{maxHeight: '100px',overflowY: 'scroll'}}>{showCategories()}</ul>\r\n                        <hr/>\r\n                        <h4>Tags</h4>\r\n                        <hr/>\r\n                        <ul style={{map: '100px',overflowY:'scroll'}}>{showTags()}</ul>\r\n                    </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nAmendJournal.modules = {\r\n    toolbar: [\r\n        [{ header: [1,2,3,4,5,6] }, { font: [] }],\r\n        [{ size: [] }],\r\n        ['bold', 'italic', 'underline', 'strike'],\r\n        [{ list: 'ordered' }, { list: 'bullet' }],\r\n        ['link', 'image', 'video'],\r\n        ['clean'],\r\n        ['code-block']\r\n    ]\r\n};\r\n \r\nAmendJournal.formats = [\r\n    'header',\r\n    'font',\r\n    'size',\r\n    'bold',\r\n    'italic',\r\n    'underline',\r\n    'strike',    \r\n    'list',\r\n    'bullet',\r\n    'link',\r\n    'image',\r\n    'video',\r\n    'code-block'\r\n];\r\n\r\nexport default withRouter(AmendJournal)\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAUA;AACA;AACA;AACA;AAJA;AATA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAiBA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAJA;AACA;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAdA;AACA;AAgBA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAfA;AACA;AAgBA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAOA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AALA;AAYA;AAgBA;;;;A","sourceRoot":""}